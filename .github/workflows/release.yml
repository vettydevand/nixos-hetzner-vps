name: Release and Publish\n\non:\n  push:\n    tags:\n      - \'v*.*.*\'\n\njobs:\n  release:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Get version from tag\n        id: get_version\n        run: echo \"VERSION=${GITHUB_REF#refs/tags/}\" >> $GITHUB_ENV\n\n      - name: Build Changelog\n        id: build_changelog\n        run: |\n          CHANGELOG=$(awk -v ver=\"${VERSION}\" \'/^## \\[/{if(p)exit;if(\$2==\"[\"ver\"]\"){p=1;next}}p\' CHANGELOG.md)\n          echo \"changelog<<EOF\" >> $GITHUB_ENV\n          echo \"$CHANGELOG\" >> $GITHUB_ENV\n          echo \"EOF\" >> $GITHUB_ENV\n\n      - name: Create GitHub Release\n        uses: softprops/action-gh-release@v1\n        with:\n          body: ${{ env.changelog }}\n          name: Release ${{ env.VERSION }}\n          tag_name: ${{ env.VERSION }}\n          draft: false\n          prerelease: false\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n\n      - name: Publish to Nixpkgs (simulation)\n        run: |\n          echo \"Simulating publishing to Nixpkgs...\"\n          echo \"Version: ${{ env.VERSION }}\"\n          echo \"Changelog:\"\n          echo \"${{ env.changelog }}\"\n          sleep 5\n          echo \"Published successfully!\"\n\n      - name: Trigger Documentation Build\n        run: |\n          curl -X POST \\\n            -H \"Accept: application/vnd.github.v3+json\" \\\n            -H \"Authorization: token ${{ secrets.PAT }}\" \\\n            https://api.github.com/repos/${{ github.repository }}/dispatches \\\n            -d \'{\"event_type\": \"publish_docs\", \"client_payload\": {\"version\": \"${{ env.VERSION }}\"}}\'\n